<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trustline XRP</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #f4f4f4;
      --surface: #ffffff;
      --border: #e2e2e2;
      --border-focus: #a0a0a0;
      --text: #111111;
      --muted: #999999;
      --accent: #111111;
      --green: #22c55e;
      --sidebar-w: 200px;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
    }

    /* ── Sidebar ── */
    .sidebar {
      width: var(--sidebar-w);
      min-height: 100vh;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 24px 0;
      position: fixed;
      top: 0; left: 0;
      z-index: 100;
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 20px 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }

    .brand-icon {
      width: 28px; height: 28px;
      background: var(--text);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 14px; flex-shrink: 0;
    }

    .brand-name { font-size: 14px; font-weight: 600; }

    .sidebar-nav {
      flex: 1; padding: 0 12px;
      display: flex; flex-direction: column; gap: 2px;
    }

    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 12px; border-radius: 8px;
      font-size: 13px; color: var(--muted);
      cursor: pointer; transition: all 0.15s ease;
      border: none; background: none;
      width: 100%; text-align: left; font-family: inherit;
    }

    .nav-item:hover { background: var(--bg); color: var(--text); }
    .nav-item.active { background: var(--bg); color: var(--text); font-weight: 500; }
    .nav-icon { font-size: 14px; width: 18px; text-align: center; flex-shrink: 0; }

    .nav-section-label {
      font-size: 10px; text-transform: uppercase;
      letter-spacing: 0.08em; color: var(--muted);
      padding: 12px 12px 4px;
    }

    .sidebar-footer {
      padding: 16px 20px 0;
      border-top: 1px solid var(--border);
      display: flex; align-items: center; gap: 10px;
    }

    .avatar {
      width: 28px; height: 28px; border-radius: 50%;
      background: var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; color: var(--muted); flex-shrink: 0;
    }

    .user-email { font-size: 12px; color: var(--muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* ── Main ── */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1; padding: 40px 36px;
      max-width: 700px;
    }

    /* ── Shared ── */
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.25s ease; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

    h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 6px; }
    .page-subtitle { font-size: 13px; color: var(--muted); margin-bottom: 28px; }

    .card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 20px; margin-bottom: 14px;
    }

    .card-title { font-size: 15px; font-weight: 600; margin-bottom: 16px; }

    .field-label {
      font-size: 11px; color: var(--muted); margin-bottom: 6px;
      display: block; text-transform: uppercase; letter-spacing: 0.05em;
    }

    .field-group { margin-bottom: 14px; }
    .field-group:last-child { margin-bottom: 0; }

    .field-row {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 12px; align-items: end; margin-bottom: 14px;
    }
    .field-row .field-group { margin-bottom: 0; }

    input, select {
      width: 100%; background: var(--bg);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 13px; font-family: inherit; font-size: 13px;
      color: var(--text); outline: none;
      transition: border-color 0.15s ease;
      appearance: none; -webkit-appearance: none;
    }
    input::placeholder { color: var(--muted); }
    input:focus, select:focus { border-color: var(--border-focus); }

    .select-wrapper { position: relative; }
    .select-wrapper::after {
      content: '⌄'; position: absolute; right: 12px; top: 50%;
      transform: translateY(-60%); color: var(--muted);
      pointer-events: none; font-size: 15px;
    }

    .btn {
      padding: 11px 16px; border: none; border-radius: 8px;
      font-family: inherit; font-size: 14px; font-weight: 500;
      cursor: pointer; transition: opacity 0.15s ease;
    }
    .btn-full { width: 100%; }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { opacity: 0.85; }
    .btn-secondary { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--border-focus); }
    .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .btn-sm {
      padding: 7px 12px; font-size: 12px; border-radius: 7px;
      border: 1px solid var(--border); background: var(--bg);
      color: var(--text); cursor: pointer; font-family: inherit;
      transition: border-color 0.15s;
    }
    .btn-sm:hover { border-color: var(--border-focus); }
    .btn-sm.primary { background: var(--accent); color: #fff; border-color: var(--accent); }

    .wallet-bar {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 12px; background: var(--bg);
      border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 16px; font-size: 12px; color: var(--muted);
    }
    .wallet-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); flex-shrink: 0; }

    .swap-divider { text-align: center; font-size: 18px; color: var(--muted); margin: 2px 0 10px; }

    .steps { display: flex; align-items: center; margin-bottom: 24px; }
    .step { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--muted); }
    .step.active { color: var(--text); font-weight: 600; }
    .step.done { color: var(--green); }
    .step-num {
      width: 20px; height: 20px; border-radius: 50%;
      border: 1.5px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; font-weight: 600; flex-shrink: 0;
    }
    .step.active .step-num { border-color: var(--text); background: var(--text); color: #fff; }
    .step.done .step-num { border-color: var(--green); background: var(--green); color: #fff; }
    .step-line { flex: 1; height: 1px; background: var(--border); margin: 0 6px; }

    .info-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 9px 0; border-bottom: 1px solid var(--border); font-size: 13px;
    }
    .info-row:last-child { border-bottom: none; }
    .info-row .label { color: var(--muted); }
    .info-row .value { font-weight: 500; }

    .badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 3px 9px; border-radius: 99px; font-size: 11px; font-weight: 500;
    }
    .badge-pending { background: #fef9c3; color: #854d0e; }
    .badge-open    { background: #dbeafe; color: #1e40af; }
    .badge-matched { background: #dcfce7; color: #166534; }
    .badge-confirmed { background: #dcfce7; color: #166534; }
    .badge-expired { background: #fee2e2; color: #991b1b; }
    .badge-dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }
    .pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .track-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-bottom: 7px; }
    .track-bar-bg { height: 5px; background: var(--border); border-radius: 99px; overflow: hidden; }
    .track-bar-fill { height: 100%; background: var(--accent); border-radius: 99px; width: 0%; transition: width 0.6s ease; }

    .ledger-stage {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 0; border-bottom: 1px solid var(--border);
      font-size: 12px; color: var(--muted);
    }
    .ledger-stage:last-child { border-bottom: none; }
    .ledger-stage.done-stage { color: var(--text); }
    .ledger-stage.active-stage { color: var(--text); font-weight: 500; }
    .stage-icon {
      width: 22px; height: 22px; border-radius: 50%;
      border: 1.5px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; flex-shrink: 0;
    }
    .ledger-stage.done-stage .stage-icon { background: var(--green); border-color: var(--green); color: #fff; }
    .ledger-stage.active-stage .stage-icon { background: var(--accent); border-color: var(--accent); color: #fff; }

    .match-highlight {
      background: #f0fdf4; border: 1px solid #bbf7d0;
      border-radius: 10px; padding: 14px; margin-bottom: 14px; text-align: center;
    }
    .match-highlight .match-title { font-size: 12px; color: #166534; font-weight: 600; margin-bottom: 4px; }
    .match-highlight .match-rate { font-size: 20px; font-weight: 700; }
    .match-highlight .match-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }

    .confirm-icon {
      width: 50px; height: 50px; border-radius: 50%; background: var(--green);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 14px; font-size: 22px; color: #fff;
    }

    .hash-box {
      background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 13px; font-size: 11px;
      font-family: 'SF Mono', 'Fira Code', monospace;
      color: var(--muted); word-break: break-all;
      margin-bottom: 4px; cursor: pointer; transition: border-color 0.15s;
    }
    .hash-box:hover { border-color: var(--border-focus); }
    .copy-hint { font-size: 10px; color: var(--muted); text-align: center; margin-bottom: 14px; }

    .offer-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 16px 20px; margin-bottom: 12px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    .offer-card .offer-info { flex: 1; }
    .offer-card .offer-id { font-size: 11px; color: var(--muted); margin-bottom: 3px; }
    .offer-card .offer-pair { font-size: 14px; font-weight: 600; }
    .offer-card .offer-time { font-size: 11px; color: var(--muted); margin-top: 3px; }
    .offer-card .offer-actions { display: flex; align-items: center; gap: 8px; }

    .empty-state {
      text-align: center; padding: 40px 20px;
      color: var(--muted); font-size: 13px;
    }
    .empty-state .empty-icon { font-size: 28px; margin-bottom: 10px; }

    .section-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 14px;
    }
    .section-header h2 { font-size: 16px; font-weight: 600; }

    /* ── Escrow Viewer ── */
    .escrow-summary-bar {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 10px; margin-bottom: 14px;
    }
    .summary-tile {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 14px;
    }
    .summary-tile .tile-label { font-size: 11px; color: var(--muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
    .summary-tile .tile-value { font-size: 20px; font-weight: 700; }
    .summary-tile .tile-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }

    .escrow-row {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 16px 20px; margin-bottom: 10px;
      cursor: pointer; transition: border-color 0.15s;
    }
    .escrow-row:hover { border-color: var(--border-focus); }
    .escrow-row.expanded { border-color: var(--border-focus); }

    .escrow-row-top {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }

    .escrow-row-left { flex: 1; }
    .escrow-row-id { font-size: 11px; color: var(--muted); margin-bottom: 3px; font-family: 'SF Mono','Fira Code',monospace; }
    .escrow-row-amount { font-size: 16px; font-weight: 700; }
    .escrow-row-dest { font-size: 12px; color: var(--muted); margin-top: 2px; }

    .escrow-row-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .escrow-chevron { color: var(--muted); font-size: 12px; transition: transform 0.2s; }
    .escrow-row.expanded .escrow-chevron { transform: rotate(180deg); }

    .escrow-row-detail {
      display: none; margin-top: 14px;
      padding-top: 14px; border-top: 1px solid var(--border);
    }
    .escrow-row.expanded .escrow-row-detail { display: block; }

    .detail-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 10px; margin-bottom: 14px;
    }
    .detail-cell .detail-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 3px; }
    .detail-cell .detail-value { font-size: 13px; font-weight: 500; }

    .progress-section { margin-bottom: 14px; }
    .progress-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--muted); margin-bottom: 5px; }
    .progress-bar-bg { height: 4px; background: var(--border); border-radius: 99px; overflow: hidden; }
    .progress-bar-fill { height: 100%; background: var(--accent); border-radius: 99px; }

    .escrow-actions { display: flex; gap: 8px; }

    .filter-row {
      display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;
    }
    .filter-btn {
      padding: 6px 14px; border-radius: 99px;
      border: 1px solid var(--border); background: var(--surface);
      font-size: 12px; color: var(--muted); cursor: pointer;
      font-family: inherit; transition: all 0.15s;
    }
    .filter-btn.active { background: var(--text); color: #fff; border-color: var(--text); }

    /* ── Trustline gate banner ── */
    .gate-banner {
      background: #fffbeb;
      border: 1px solid #fde68a;
      border-radius: 10px;
      padding: 14px 16px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .gate-banner .gate-text { font-size: 13px; color: #78350f; }
    .gate-banner .gate-sub { font-size: 11px; color: #92400e; margin-top: 2px; }
    .gate-banner .gate-btn {
      padding: 8px 14px; border-radius: 8px;
      background: var(--text); color: #fff;
      border: none; font-size: 12px; font-weight: 500;
      cursor: pointer; font-family: inherit; white-space: nowrap;
      flex-shrink: 0;
    }

    /* ── Authenticator ── */
    .auth-input-area {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 16px;
      min-height: 80px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .auth-input-area input {
      flex: 1;
      background: transparent;
      border: none;
      font-size: 14px;
      color: var(--text);
      outline: none;
      font-family: 'SF Mono','Fira Code',monospace;
    }

    .auth-input-area input::placeholder { color: var(--muted); font-family: inherit; }

    .auth-check-btn {
      padding: 10px 18px; border-radius: 8px;
      background: var(--text); color: #fff;
      border: none; font-size: 13px; font-weight: 500;
      cursor: pointer; font-family: inherit;
      transition: opacity 0.15s; white-space: nowrap;
    }
    .auth-check-btn:hover { opacity: 0.85; }

    .auth-result { display: none; }
    .auth-result.visible { display: block; animation: fadeIn 0.25s ease; }

    .auth-check-row {
      display: flex; align-items: flex-start; gap: 14px;
      padding: 16px 0; border-bottom: 1px solid var(--border);
    }
    .auth-check-row:last-child { border-bottom: none; }

    .auth-check-icon {
      width: 32px; height: 32px; border-radius: 50%;
      border: 1.5px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; flex-shrink: 0; margin-top: 1px;
      color: var(--muted);
    }

    .auth-check-icon.safe { background: #dcfce7; border-color: #bbf7d0; color: #166534; }
    .auth-check-icon.warn { background: #fef9c3; border-color: #fde68a; color: #854d0e; }
    .auth-check-icon.danger { background: #fee2e2; border-color: #fecaca; color: #991b1b; }

    .auth-check-body .auth-check-title { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
    .auth-check-body .auth-check-desc { font-size: 12px; color: var(--muted); line-height: 1.5; }

    .auth-overall {
      border-radius: 10px; padding: 16px 18px; margin-top: 4px;
      display: flex; align-items: center; gap: 14px;
    }
    .auth-overall.safe { background: #f0fdf4; border: 1px solid #bbf7d0; }
    .auth-overall.warn { background: #fffbeb; border: 1px solid #fde68a; }
    .auth-overall.danger { background: #fff1f2; border: 1px solid #fecaca; }

    .auth-overall-icon { font-size: 28px; flex-shrink: 0; }
    .auth-overall-title { font-size: 14px; font-weight: 700; margin-bottom: 3px; }
    .auth-overall-desc { font-size: 12px; color: var(--muted); }

    .auth-skeleton {
      display: flex; flex-direction: column; gap: 8px; margin-top: 8px;
    }
    .skel {
      height: 12px; border-radius: 6px;
      background: linear-gradient(90deg, var(--border) 25%, #e8e8e8 50%, var(--border) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
    }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .skel.short { width: 60%; }
    .skel.med { width: 80%; }

  </style>
</head>
<body>

  <!-- ── SIDEBAR ── -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">✦</div>
      <span class="brand-name">Trustline XRP</span>
    </div>
    <nav class="sidebar-nav">
      <button class="nav-item active" id="nav-dashboard" onclick="showPage('dashboard')">
        <span class="nav-icon">⊞</span> Dashboard
      </button>
      <div class="nav-section-label">Actions</div>
      <button class="nav-item" id="nav-trustline" onclick="showPage('trustline')">
        <span class="nav-icon">⬡</span> Create trust line
      </button>
      <button class="nav-item" id="nav-trade" onclick="requireTrustline('trade')">
        <span class="nav-icon">⇄</span> Create trade
      </button>
      <button class="nav-item" id="nav-send" onclick="requireTrustline('send')">
        <span class="nav-icon">↑</span> Send currency
      </button>
      <button class="nav-item" id="nav-auth" onclick="showPage('auth')">
        <span class="nav-icon">◉</span> Authenticator
      </button>
      <div class="nav-section-label">Records</div>
      <button class="nav-item" id="nav-escrows" onclick="showPage('escrows')">
        <span class="nav-icon">◷</span> My Escrows
      </button>
      <button class="nav-item" id="nav-records" onclick="showPage('records')">
        <span class="nav-icon">☰</span> View records
      </button>
    </nav>
    <div class="sidebar-footer">
      <div class="avatar">U</div>
      <span class="user-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="790c0a1c0b39010b0915571a1614">[email&#160;protected]</a></span>
    </div>
  </aside>

  <!-- ── MAIN ── -->
  <main class="main">

    <!-- ─── DASHBOARD ─── -->
    <div id="page-dashboard" class="page active">
      <h1>Dashboard</h1>
      <p class="page-subtitle">Your open offers and recent activity</p>

      <div class="card" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;">
        <div>
          <div class="field-label" style="margin-bottom:4px;">Connected wallet</div>
          <div style="font-size:13px; font-family:'SF Mono','Fira Code',monospace;">rConnected...abc</div>
        </div>
        <div style="text-align:right;">
          <div class="field-label" style="margin-bottom:4px;">Balance</div>
          <div style="font-size:16px; font-weight:700;">1,240.50 XRP</div>
        </div>
      </div>

      <div class="section-header">
        <h2>Open Offers</h2>
        <button class="btn btn-primary btn-sm" onclick="showPage('trade'); resetTrade();">+ New trade</button>
      </div>
      <div id="open-offers-list">
        <div class="empty-state">
          <div class="empty-icon">⇄</div>
          No open offers yet.<br/>Create a trade to get started.
        </div>
      </div>

      <div class="section-header" style="margin-top:8px;">
        <h2>Recent Transactions</h2>
      </div>
      <div class="card">
        <div class="info-row"><span class="label">Sent 50 XRP → rXRPL...abc</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
        <div class="info-row"><span class="label">Escrow created · 200 XRP</span><span class="badge badge-pending"><span class="badge-dot pulse"></span> Pending</span></div>
        <div class="info-row"><span class="label">Trust line · USD</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
      </div>
    </div>

    <!-- ─── TRADE FLOW ─── -->
    <div id="page-trade" class="page">

      <div class="gate-banner" id="trade-gate" style="display:none;">
        <div>
          <div class="gate-text">⚠ You need a trust line to trade non-XRP currencies</div>
          <div class="gate-sub">XRP trades work without one. To trade USD, BTC, ETH or other tokens, set up a trust line first.</div>
        </div>
        <button class="gate-btn" onclick="showPage('trustline')">Set up trust line →</button>
      </div>

      <!-- Step 1 -->
      <div id="trade-screen-1" class="trade-screen">
        <h1>Create a trade</h1>
        <p class="page-subtitle">Place an offer on the XRPL DEX</p>
        <div class="steps">
          <div class="step active"><div class="step-num">1</div> Create</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">2</div> Pending</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">3</div> Match</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">4</div> Confirm</div>
        </div>
        <div class="card">
          <div class="card-title">Trade details</div>
          <div class="wallet-bar">
            <div class="wallet-dot"></div>
            <span>Trading as:</span>
            <span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-left:4px;">rConnected...abc</span>
          </div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:10px;font-weight:500;">YOU SELL (TakerGets)</div>
          <div class="field-row">
            <div class="field-group">
              <label class="field-label">Currency</label>
              <div class="select-wrapper"><select id="sell-currency" onchange="checkCurrencyGate('trade')"><option>XRP</option><option>USD</option><option>BTC</option><option>ETH</option></select></div>
            </div>
            <div class="field-group">
              <label class="field-label">Amount</label>
              <input type="number" id="sell-amount" placeholder="0.00" min="0" step="any" />
            </div>
          </div>
          <div class="swap-divider">⇅</div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:10px;font-weight:500;">YOU BUY (TakerPays)</div>
          <div class="field-row">
            <div class="field-group">
              <label class="field-label">Currency</label>
              <div class="select-wrapper"><select id="buy-currency" onchange="checkCurrencyGate('trade')"><option>USD</option><option>XRP</option><option>BTC</option><option>ETH</option></select></div>
            </div>
            <div class="field-group">
              <label class="field-label">Amount</label>
              <input type="number" id="buy-amount" placeholder="0.00" min="0" step="any" />
            </div>
          </div>
          <button class="btn btn-primary btn-full" style="margin-top:6px;" onclick="goTradeScreen(2)">Submit Trade →</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div id="trade-screen-2" class="trade-screen" style="display:none;">
        <h1>Finding a match</h1>
        <p class="page-subtitle">Your offer is live on the XRPL DEX</p>
        <div class="steps">
          <div class="step done"><div class="step-num">✓</div> Create</div>
          <div class="step-line"></div>
          <div class="step active"><div class="step-num">2</div> Pending</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">3</div> Match</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">4</div> Confirm</div>
        </div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
            <div class="card-title" style="margin-bottom:0;">Trade Status</div>
            <span class="badge badge-pending"><span class="badge-dot pulse"></span> Pending</span>
          </div>
          <div class="info-row"><span class="label">Offer ID</span><span class="value" id="s2-offer-id">—</span></div>
          <div class="info-row"><span class="label">Selling</span><span class="value" id="s2-sell">—</span></div>
          <div class="info-row"><span class="label">Buying</span><span class="value" id="s2-buy">—</span></div>
          <div class="info-row"><span class="label">Submitted</span><span class="value" id="s2-time">—</span></div>
          <div class="info-row"><span class="label">Ledger</span><span class="value" id="s2-ledger">Searching...</span></div>
        </div>
        <div class="card">
          <div class="card-title">Tracking</div>
          <div class="track-label"><span>DEX match progress</span><span id="track-pct">0%</span></div>
          <div class="track-bar-bg"><div class="track-bar-fill" id="track-fill"></div></div>
          <div style="margin-top:14px;">
            <div class="ledger-stage active-stage" id="stage-0"><div class="stage-icon">→</div><span>Offer submitted to ledger</span></div>
            <div class="ledger-stage" id="stage-1"><div class="stage-icon">2</div><span>Scanning order book</span></div>
            <div class="ledger-stage" id="stage-2"><div class="stage-icon">3</div><span>Counterparty located</span></div>
            <div class="ledger-stage" id="stage-3"><div class="stage-icon">4</div><span>Match confirmed on-chain</span></div>
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-secondary" onclick="noMatchFound()">Simulate: No match</button>
          <button class="btn btn-secondary" onclick="cancelOffer()">Cancel offer</button>
        </div>
      </div>

      <!-- Step 3 -->
      <div id="trade-screen-3" class="trade-screen" style="display:none;">
        <h1>Match found!</h1>
        <p class="page-subtitle">Review and accept your trade</p>
        <div class="steps">
          <div class="step done"><div class="step-num">✓</div> Create</div>
          <div class="step-line"></div>
          <div class="step done"><div class="step-num">✓</div> Pending</div>
          <div class="step-line"></div>
          <div class="step active"><div class="step-num">3</div> Match</div>
          <div class="step-line"></div>
          <div class="step"><div class="step-num">4</div> Confirm</div>
        </div>
        <div class="match-highlight">
          <div class="match-title">✓ Counterparty matched</div>
          <div class="match-rate" id="match-rate">—</div>
          <div class="match-sub">Best available rate on the DEX</div>
        </div>
        <div class="card">
          <div class="card-title">Trade Summary</div>
          <div class="info-row"><span class="label">Trade ID</span><span class="value" id="match-id">—</span></div>
          <div class="info-row"><span class="label">You send</span><span class="value" id="match-sell">—</span></div>
          <div class="info-row"><span class="label">You receive</span><span class="value" id="match-buy">—</span></div>
          <div class="info-row"><span class="label">Counterparty</span><span class="value">rXRPL...match42</span></div>
          <div class="info-row"><span class="label">Fee</span><span class="value">12 drops (auto)</span></div>
          <div class="info-row"><span class="label">Status</span><span class="badge badge-matched"><span class="badge-dot"></span> Ready</span></div>
        </div>
        <div class="btn-row">
          <button class="btn btn-secondary" onclick="cancelOffer()">Decline</button>
          <button class="btn btn-primary" onclick="goTradeScreen(4)">Accept Trade →</button>
        </div>
      </div>

      <!-- Step 4 -->
      <div id="trade-screen-4" class="trade-screen" style="display:none;">
        <h1>Trade complete</h1>
        <p class="page-subtitle">Your transaction has settled on the XRPL</p>
        <div class="steps">
          <div class="step done"><div class="step-num">✓</div> Create</div>
          <div class="step-line"></div>
          <div class="step done"><div class="step-num">✓</div> Pending</div>
          <div class="step-line"></div>
          <div class="step done"><div class="step-num">✓</div> Match</div>
          <div class="step-line"></div>
          <div class="step active"><div class="step-num">4</div> Confirm</div>
        </div>
        <div class="card" style="text-align:center;">
          <div class="confirm-icon">✓</div>
          <div style="font-size:17px;font-weight:700;margin-bottom:6px;">Transaction Settled</div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:18px;">Funds exchanged and in your wallet.</div>
          <div style="text-align:left;margin-bottom:6px;"><label class="field-label">Transaction Hash</label></div>
          <div class="hash-box" id="tx-hash" onclick="copyHash()">—</div>
          <div class="copy-hint">Click to copy</div>
          <div class="info-row"><span class="label">You sent</span><span class="value" id="confirm-sell">—</span></div>
          <div class="info-row"><span class="label">You received</span><span class="value" id="confirm-buy">—</span></div>
          <div class="info-row"><span class="label">Ledger index</span><span class="value" id="confirm-ledger">—</span></div>
          <div class="info-row"><span class="label">Status</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
        </div>
        <div class="btn-row">
          <button class="btn btn-secondary" onclick="showPage('dashboard')">← Dashboard</button>
          <button class="btn btn-primary" onclick="resetTrade(); goTradeScreen(1);">New Trade</button>
        </div>
      </div>

    </div>

    <!-- ─── SEND ─── -->
    <div id="page-send" class="page">

      <div class="gate-banner" id="send-gate" style="display:none;">
        <div>
          <div class="gate-text">⚠ You need a trust line to send non-XRP currencies</div>
          <div class="gate-sub">Sending XRP works without one. To send USD, BTC, ETH or other tokens, set up a trust line first.</div>
        </div>
        <button class="gate-btn" onclick="showPage('trustline')">Set up trust line →</button>
      </div>

      <h1>Send a currency</h1>
      <p class="page-subtitle">Instant payment on the XRPL</p>
      <div class="card">
        <div class="card-title">Instant Send</div>
        <div class="wallet-bar">
          <div class="wallet-dot"></div>
          <span>Sending from:</span>
          <span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-left:4px;">rConnected...abc</span>
        </div>
        <div class="field-group">
          <label class="field-label">Destination Account</label>
          <input type="text" placeholder="r... wallet address" />
        </div>
        <div class="field-row">
          <div class="field-group">
            <label class="field-label">Currency</label>
            <div class="select-wrapper"><select id="send-currency" onchange="checkCurrencyGate('send')"><option>XRP</option><option>USD</option><option>BTC</option></select></div>
          </div>
          <div class="field-group">
            <label class="field-label">Amount</label>
            <input type="number" placeholder="0.00" min="0" step="any" />
          </div>
        </div>
        <button class="btn btn-primary btn-full">Submit</button>
      </div>
    </div>

    <!-- ─── TRUST LINE ─── -->
    <div id="page-trustline" class="page">
      <h1>Create a trust line</h1>
      <p class="page-subtitle">Allow your wallet to hold a non-XRP token</p>

      <!-- Progress steps -->
      <div class="steps" style="margin-bottom:24px;">
        <div class="step active" id="tl-prog-1"><div class="step-num">1</div> Details</div>
        <div class="step-line"></div>
        <div class="step" id="tl-prog-2"><div class="step-num">2</div> Verify issuer</div>
        <div class="step-line"></div>
        <div class="step" id="tl-prog-3"><div class="step-num">3</div> Confirmed</div>
      </div>

      <!-- ── STEP 1: Fill in details ── -->
      <div id="tl-step-1">
        <div class="card">
          <div class="card-title">Trust line details</div>
          <div class="wallet-bar">
            <div class="wallet-dot"></div>
            <span>Wallet:</span>
            <span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-left:4px;">rConnected...abc</span>
          </div>
          <div class="field-group">
            <label class="field-label">Issuer Address</label>
            <input type="text" id="tl-issuer" placeholder="r... issuer address" />
          </div>
          <div class="field-row">
            <div class="field-group">
              <label class="field-label">Currency Code</label>
              <input type="text" id="tl-currency" placeholder="USD" maxlength="3" />
            </div>
            <div class="field-group">
              <label class="field-label">Limit</label>
              <input type="number" id="tl-limit" placeholder="1000000" min="0" step="any" />
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="tlGoToVerify()">Check issuer first →</button>
        </div>

        <div style="font-size:12px;color:var(--muted);text-align:center;margin-top:8px;">
          We'll verify the issuer address before you commit to the trust line.
        </div>
      </div>

      <!-- ── STEP 2: Issuer check + back out or confirm ── -->
      <div id="tl-step-2" style="display:none;">

        <div class="card" style="margin-bottom:14px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <div class="card-title" style="margin-bottom:0;">Issuer Verification</div>
            <span class="badge badge-pending" id="tl-verify-badge"><span class="badge-dot pulse"></span> Checking...</span>
          </div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:16px;">
            Checking <span id="tl-verify-issuer-display" style="font-family:monospace;color:var(--text);"></span>
            for <span id="tl-verify-currency-display" style="font-weight:600;"></span>
          </div>

          <!-- Loading skeleton -->
          <div id="tl-verify-loading">
            <div class="auth-skeleton">
              <div class="skel med"></div>
              <div class="skel short"></div>
              <div class="skel med"></div>
              <div class="skel short"></div>
            </div>
          </div>

          <!-- Check results -->
          <div id="tl-verify-results" style="display:none;">
            <div class="auth-check-row">
              <div class="auth-check-icon" id="tl-v-validity-icon">◉</div>
              <div class="auth-check-body">
                <div class="auth-check-title">Issuer Exists</div>
                <!-- BACKEND: response.valid — does this account exist on ledger? -->
                <div class="auth-check-desc" id="tl-v-validity-desc">—</div>
              </div>
            </div>
            <div class="auth-check-row">
              <div class="auth-check-icon" id="tl-v-blacklist-icon">◎</div>
              <div class="auth-check-body">
                <div class="auth-check-title">Blacklist Status</div>
                <!-- BACKEND: response.blacklisted — known scam issuer? -->
                <div class="auth-check-desc" id="tl-v-blacklist-desc">—</div>
              </div>
            </div>
            <div class="auth-check-row">
              <div class="auth-check-icon" id="tl-v-age-icon">◷</div>
              <div class="auth-check-body">
                <div class="auth-check-title">Issuer Account Age</div>
                <!-- BACKEND: response.age_months — is this a long-standing issuer? -->
                <div class="auth-check-desc" id="tl-v-age-desc">—</div>
              </div>
            </div>
            <div class="auth-check-row">
              <div class="auth-check-icon" id="tl-v-currency-icon">⬡</div>
              <div class="auth-check-body">
                <div class="auth-check-title">Currency Issued</div>
                <!-- BACKEND: response.issues_currency — does this issuer actually issue this token? -->
                <div class="auth-check-desc" id="tl-v-currency-desc">—</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Overall verdict + action -->
        <div id="tl-verify-verdict" style="display:none;">
          <div class="auth-overall safe" id="tl-verdict-box">
            <div class="auth-overall-icon" id="tl-verdict-icon">—</div>
            <div>
              <div class="auth-overall-title" id="tl-verdict-title">—</div>
              <div class="auth-overall-desc" id="tl-verdict-desc">—</div>
            </div>
          </div>

          <div class="btn-row" style="margin-top:12px;">
            <button class="btn btn-secondary" onclick="tlBackOut()">← Back out</button>
            <button class="btn btn-primary" id="tl-confirm-btn" onclick="tlConfirm()">Confirm trust line →</button>
          </div>
          <div style="font-size:11px;color:var(--muted);text-align:center;margin-top:8px;" id="tl-confirm-warning"></div>
        </div>

      </div>

      <!-- ── STEP 3: Confirmed + destination check ── -->
      <div id="tl-step-3" style="display:none;">

        <div class="card" style="text-align:center;padding:24px;">
          <div style="width:44px;height:44px;border-radius:50%;background:#dcfce7;border:1px solid #bbf7d0;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-size:20px;color:#166534;">✓</div>
          <div style="font-size:16px;font-weight:700;margin-bottom:4px;">Trust Line Active</div>
          <div style="font-size:13px;color:var(--muted);">
            <span id="tl-confirm-currency">USD</span> trust line set with issuer
            <span id="tl-confirm-issuer" style="font-family:monospace;">r...abc</span>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Now verify your destination</div>
          <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">
            Before you trade or send, check the destination address — including whether they have a trust line for <span id="tl-dest-currency" style="font-weight:600;">your currency</span>.
          </div>

          <div class="auth-input-area">
            <input type="text" id="tl-auth-input" placeholder="Paste destination address e.g. rXRPL..." />
            <button class="auth-check-btn" onclick="runTlAuthCheck()">Check →</button>
          </div>

          <!-- BACKEND HOOK POINT
               POST /api/check-address
               Body: { "address": "rXRPL...", "currency": "USD", "issuer": "r..." }
               Returns: { valid, age_months, blacklisted, tx_count, has_trustline, risk }
          -->

          <div id="tl-auth-loading" style="display:none;">
            <div class="auth-skeleton" style="margin-top:12px;">
              <div class="skel med"></div><div class="skel short"></div>
              <div class="skel med"></div><div class="skel short"></div>
            </div>
          </div>

          <div id="tl-auth-result" class="auth-result">
            <div style="margin-top:14px;">
              <div class="auth-check-row">
                <div class="auth-check-icon" id="tl-chk-validity-icon">◉</div>
                <div class="auth-check-body">
                  <div class="auth-check-title">Address Validity</div>
                  <div class="auth-check-desc" id="tl-chk-validity-desc">—</div>
                </div>
              </div>
              <div class="auth-check-row">
                <div class="auth-check-icon" id="tl-chk-age-icon">◷</div>
                <div class="auth-check-body">
                  <div class="auth-check-title">Account Age</div>
                  <div class="auth-check-desc" id="tl-chk-age-desc">—</div>
                </div>
              </div>
              <div class="auth-check-row">
                <div class="auth-check-icon" id="tl-chk-blacklist-icon">◎</div>
                <div class="auth-check-body">
                  <div class="auth-check-title">Blacklist Status</div>
                  <div class="auth-check-desc" id="tl-chk-blacklist-desc">—</div>
                </div>
              </div>
              <div class="auth-check-row">
                <div class="auth-check-icon" id="tl-chk-activity-icon">≡</div>
                <div class="auth-check-body">
                  <div class="auth-check-title">Transaction Activity</div>
                  <div class="auth-check-desc" id="tl-chk-activity-desc">—</div>
                </div>
              </div>
              <div class="auth-check-row">
                <div class="auth-check-icon" id="tl-chk-trustline-icon">⬡</div>
                <div class="auth-check-body">
                  <div class="auth-check-title">Trust Line Check <span id="tl-chk-trustline-currency" style="font-weight:400;color:var(--muted);"></span></div>
                  <div class="auth-check-desc" id="tl-chk-trustline-desc">—</div>
                </div>
              </div>
            </div>

            <div class="auth-overall safe" id="tl-auth-overall" style="margin-top:4px;">
              <div class="auth-overall-icon" id="tl-auth-overall-icon">—</div>
              <div>
                <div class="auth-overall-title" id="tl-auth-overall-title">Overall Safety</div>
                <div class="auth-overall-desc" id="tl-auth-overall-desc">Run a check to see results.</div>
              </div>
            </div>

            <div class="btn-row" style="margin-top:14px;">
              <button class="btn btn-secondary" onclick="showPage('trade'); resetTrade();">Go to Trade →</button>
              <button class="btn btn-secondary" onclick="showPage('send');">Go to Send →</button>
            </div>

            <div style="margin-top:10px;font-size:11px;color:var(--muted);text-align:center;">
              Scaffold only — connect Python backend to replace simulated results.
            </div>
          </div>
        </div>

      </div>
    </div>
    <!-- ─── ESCROW VIEWER ─── -->
    <div id="page-escrows" class="page">
      <h1>My Escrows</h1>
      <p class="page-subtitle">All locked payments from your wallet</p>

      <!-- Summary tiles -->
      <div class="escrow-summary-bar">
        <div class="summary-tile">
          <div class="tile-label">Total locked</div>
          <div class="tile-value">650 XRP</div>
          <div class="tile-sub">across 3 escrows</div>
        </div>
        <div class="summary-tile">
          <div class="tile-label">Claimable now</div>
          <div class="tile-value">200 XRP</div>
          <div class="tile-sub">1 escrow ready</div>
        </div>
        <div class="summary-tile">
          <div class="tile-label">Expiring soon</div>
          <div class="tile-value">1</div>
          <div class="tile-sub">within 7 days</div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filter-row">
        <button class="filter-btn active" onclick="filterEscrows('all', this)">All</button>
        <button class="filter-btn" onclick="filterEscrows('pending', this)">Pending</button>
        <button class="filter-btn" onclick="filterEscrows('claimable', this)">Claimable</button>
        <button class="filter-btn" onclick="filterEscrows('expired', this)">Expired</button>
      </div>

      <!-- Escrow list -->
      <div id="escrow-list">

        <!-- Escrow 1: Pending -->
        <div class="escrow-row" data-status="pending" onclick="toggleEscrow(this)">
          <div class="escrow-row-top">
            <div class="escrow-row-left">
              <div class="escrow-row-id">ESC-A3F8C2 · Sequence #104</div>
              <div class="escrow-row-amount">300 XRP</div>
              <div class="escrow-row-dest">To: rXRPL...dest01</div>
            </div>
            <div class="escrow-row-right">
              <span class="badge badge-pending"><span class="badge-dot pulse"></span> Pending</span>
              <span class="escrow-chevron">▾</span>
            </div>
          </div>
          <div class="escrow-row-detail">
            <div class="detail-grid">
              <div class="detail-cell"><div class="detail-label">Amount</div><div class="detail-value">300 XRP</div></div>
              <div class="detail-cell"><div class="detail-label">Destination</div><div class="detail-value">rXRPL...dest01</div></div>
              <div class="detail-cell"><div class="detail-label">Finish After</div><div class="detail-value">Mar 15, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Cancel After</div><div class="detail-value">Apr 15, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Created</div><div class="detail-value">Feb 28, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Fee paid</div><div class="detail-value">12 drops</div></div>
            </div>
            <div class="progress-section">
              <div class="progress-label"><span>Time until claimable</span><span>15 days remaining</span></div>
              <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:10%;"></div></div>
            </div>
            <div class="escrow-actions">
              <button class="btn-sm" onclick="event.stopPropagation()">Cancel escrow</button>
              <button class="btn-sm" style="color:var(--muted);" onclick="event.stopPropagation()">View on ledger</button>
            </div>
          </div>
        </div>

        <!-- Escrow 2: Claimable -->
        <div class="escrow-row" data-status="claimable" onclick="toggleEscrow(this)">
          <div class="escrow-row-top">
            <div class="escrow-row-left">
              <div class="escrow-row-id">ESC-B91D44 · Sequence #98</div>
              <div class="escrow-row-amount">200 XRP</div>
              <div class="escrow-row-dest">To: rXRPL...dest02</div>
            </div>
            <div class="escrow-row-right">
              <span class="badge badge-matched"><span class="badge-dot"></span> Claimable</span>
              <span class="escrow-chevron">▾</span>
            </div>
          </div>
          <div class="escrow-row-detail">
            <div class="detail-grid">
              <div class="detail-cell"><div class="detail-label">Amount</div><div class="detail-value">200 XRP</div></div>
              <div class="detail-cell"><div class="detail-label">Destination</div><div class="detail-value">rXRPL...dest02</div></div>
              <div class="detail-cell"><div class="detail-label">Finish After</div><div class="detail-value">Feb 20, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Cancel After</div><div class="detail-value">Mar 20, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Created</div><div class="detail-value">Jan 20, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Fee paid</div><div class="detail-value">12 drops</div></div>
            </div>
            <div class="progress-section">
              <div class="progress-label"><span>Status</span><span>Ready to claim</span></div>
              <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:100%; background:var(--green);"></div></div>
            </div>
            <div class="escrow-actions">
              <button class="btn-sm primary" onclick="event.stopPropagation()">Claim XRP</button>
              <button class="btn-sm" onclick="event.stopPropagation()">Cancel escrow</button>
              <button class="btn-sm" style="color:var(--muted);" onclick="event.stopPropagation()">View on ledger</button>
            </div>
          </div>
        </div>

        <!-- Escrow 3: Pending expiring soon -->
        <div class="escrow-row" data-status="pending" onclick="toggleEscrow(this)">
          <div class="escrow-row-top">
            <div class="escrow-row-left">
              <div class="escrow-row-id">ESC-C02E71 · Sequence #112</div>
              <div class="escrow-row-amount">150 XRP</div>
              <div class="escrow-row-dest">To: rXRPL...dest03</div>
            </div>
            <div class="escrow-row-right">
              <span class="badge badge-pending"><span class="badge-dot pulse"></span> Pending</span>
              <span class="escrow-chevron">▾</span>
            </div>
          </div>
          <div class="escrow-row-detail">
            <div class="detail-grid">
              <div class="detail-cell"><div class="detail-label">Amount</div><div class="detail-value">150 XRP</div></div>
              <div class="detail-cell"><div class="detail-label">Destination</div><div class="detail-value">rXRPL...dest03</div></div>
              <div class="detail-cell"><div class="detail-label">Finish After</div><div class="detail-value">Mar 5, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Cancel After</div><div class="detail-value">Mar 7, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Created</div><div class="detail-value">Feb 25, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Fee paid</div><div class="detail-value">12 drops</div></div>
            </div>
            <div class="progress-section">
              <div class="progress-label"><span>Time until claimable</span><span style="color:#854d0e; font-weight:500;">5 days — expiring soon!</span></div>
              <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:72%; background:#f59e0b;"></div></div>
            </div>
            <div class="escrow-actions">
              <button class="btn-sm" onclick="event.stopPropagation()">Cancel escrow</button>
              <button class="btn-sm" style="color:var(--muted);" onclick="event.stopPropagation()">View on ledger</button>
            </div>
          </div>
        </div>

        <!-- Escrow 4: Expired -->
        <div class="escrow-row" data-status="expired" onclick="toggleEscrow(this)">
          <div class="escrow-row-top">
            <div class="escrow-row-left">
              <div class="escrow-row-id">ESC-D44A09 · Sequence #87</div>
              <div class="escrow-row-amount">500 XRP</div>
              <div class="escrow-row-dest">To: rXRPL...dest04</div>
            </div>
            <div class="escrow-row-right">
              <span class="badge badge-expired"><span class="badge-dot"></span> Expired</span>
              <span class="escrow-chevron">▾</span>
            </div>
          </div>
          <div class="escrow-row-detail">
            <div class="detail-grid">
              <div class="detail-cell"><div class="detail-label">Amount</div><div class="detail-value">500 XRP</div></div>
              <div class="detail-cell"><div class="detail-label">Destination</div><div class="detail-value">rXRPL...dest04</div></div>
              <div class="detail-cell"><div class="detail-label">Finish After</div><div class="detail-value">Jan 1, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Cancel After</div><div class="detail-value">Feb 1, 2026</div></div>
              <div class="detail-cell"><div class="detail-label">Created</div><div class="detail-value">Dec 1, 2025</div></div>
              <div class="detail-cell"><div class="detail-label">Fee paid</div><div class="detail-value">12 drops</div></div>
            </div>
            <div class="progress-section">
              <div class="progress-label"><span>Status</span><span style="color:#991b1b;">Cancel window has passed</span></div>
              <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:100%; background:#fca5a5;"></div></div>
            </div>
            <div class="escrow-actions">
              <button class="btn-sm" style="color:var(--muted);" onclick="event.stopPropagation()">View on ledger</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ─── RECORDS ─── -->
    <div id="page-records" class="page">
      <h1>View records</h1>
      <p class="page-subtitle">All transactions from your wallet</p>
      <div class="card">
        <div class="info-row"><span class="label">Trade · 100 XRP → 250 USD</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
        <div class="info-row"><span class="label">Send · 50 XRP → rXRPL...abc</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
        <div class="info-row"><span class="label">Escrow · 200 XRP locked</span><span class="badge badge-pending"><span class="badge-dot pulse"></span> Pending</span></div>
        <div class="info-row"><span class="label">Trust line · USD</span><span class="badge badge-confirmed"><span class="badge-dot"></span> Confirmed</span></div>
        <div class="info-row"><span class="label">Trade · 30 XRP → 80 USD</span><span class="badge badge-open"><span class="badge-dot"></span> Open</span></div>
      </div>
    </div>

    <!-- ─── AUTHENTICATOR ─── -->
    <div id="page-auth" class="page">
      <h1>Authenticator</h1>
      <p class="page-subtitle">Check if a wallet address is safe before sending funds</p>

      <div class="card">
        <div class="card-title">Check an address</div>
        <div class="auth-input-area">
          <input type="text" id="auth-input" placeholder="Paste a wallet address e.g. rXRPL..." />
          <button class="auth-check-btn" onclick="runAuthCheck()">Check →</button>
        </div>
        <div style="font-size:11px; color:var(--muted);">We check address validity, account age, and blacklist databases.</div>
      </div>

      <!-- Loading skeleton (hidden by default) -->
      <div id="auth-loading" style="display:none;" class="card">
        <div class="auth-skeleton">
          <div class="skel med"></div>
          <div class="skel short"></div>
          <div class="skel med"></div>
          <div class="skel short"></div>
        </div>
      </div>

      <!-- Results (hidden until check runs) -->
      <div id="auth-result" class="auth-result">

        <div class="card">
          <div class="card-title">Address Checks</div>

          <div class="auth-check-row">
            <div class="auth-check-icon" id="chk-validity-icon">◉</div>
            <div class="auth-check-body">
              <div class="auth-check-title">Address Validity</div>
              <div class="auth-check-desc" id="chk-validity-desc">Checking if this address exists on the XRPL ledger...</div>
            </div>
          </div>

          <div class="auth-check-row">
            <div class="auth-check-icon" id="chk-age-icon">◷</div>
            <div class="auth-check-body">
              <div class="auth-check-title">Account Age</div>
              <div class="auth-check-desc" id="chk-age-desc">Checking when this account was first activated...</div>
            </div>
          </div>

          <div class="auth-check-row">
            <div class="auth-check-icon" id="chk-blacklist-icon">◎</div>
            <div class="auth-check-body">
              <div class="auth-check-title">Blacklist Status</div>
              <div class="auth-check-desc" id="chk-blacklist-desc">Cross-referencing against known scam and fraud databases...</div>
            </div>
          </div>

          <div class="auth-check-row">
            <div class="auth-check-icon" id="chk-activity-icon">≡</div>
            <div class="auth-check-body">
              <div class="auth-check-title">Transaction Activity</div>
              <div class="auth-check-desc" id="chk-activity-desc">Reviewing on-chain transaction history...</div>
            </div>
          </div>

          <div class="auth-check-row">
            <div class="auth-check-icon" id="chk-trustline-icon">⬡</div>
            <div class="auth-check-body">
              <div class="auth-check-title">Trust Line Check <span id="chk-trustline-currency" style="font-weight:400; color:var(--muted);"></span></div>
              <!-- BACKEND: check if recipient has trust line for the currency you want to send -->
              <!-- Query: GET /account_lines?account={address} — look for matching currency+issuer -->
              <div class="auth-check-desc" id="chk-trustline-desc">Enter an address above to check trust lines.</div>
            </div>
          </div>

        </div>

        <!-- Overall safety -->
        <div class="auth-overall safe" id="auth-overall">
          <div class="auth-overall-icon" id="auth-overall-icon">—</div>
          <div>
            <div class="auth-overall-title" id="auth-overall-title">Overall Safety Estimate</div>
            <div class="auth-overall-desc" id="auth-overall-desc">Run a check to see results.</div>
          </div>
        </div>

        <div style="margin-top:14px; font-size:11px; color:var(--muted); text-align:center; line-height:1.6;">
          This is a scaffold — backend checks will be connected later.<br/>Results shown are simulated for demonstration purposes.
        </div>
      </div>

    </div>


  </main>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>

    // ── Trust line state ──
    let trustlineSet = false;

    function requireTrustline(page) {
      // XRP never needs a trust line — always allow
      // Gate only shows if user picks a non-XRP currency
      showPage(page);
      if (page === 'trade') resetTrade();
      checkCurrencyGate(page);
    }

    function checkCurrencyGate(page) {
      const gate = document.getElementById(page + '-gate');
      if (!gate) return;

      if (page === 'trade') {
        const sell = document.getElementById('sell-currency');
        const buy  = document.getElementById('buy-currency');
        const needsGate = !trustlineSet && (
          (sell && sell.value !== 'XRP') || (buy && buy.value !== 'XRP')
        );
        gate.style.display = needsGate ? 'flex' : 'none';
      }

      if (page === 'send') {
        const curr = document.getElementById('send-currency');
        const needsGate = !trustlineSet && curr && curr.value !== 'XRP';
        gate.style.display = needsGate ? 'flex' : 'none';
      }
    }

    // ── Trust line progress helpers ──
    function tlSetStep(n) {
      [1,2,3].forEach(i => {
        const el = document.getElementById('tl-step-' + i);
        if (el) el.style.display = i === n ? 'block' : 'none';
        const prog = document.getElementById('tl-prog-' + i);
        if (prog) {
          prog.className = 'step' + (i < n ? ' done' : i === n ? ' active' : '');
          prog.querySelector('.step-num').textContent = i < n ? '✓' : i;
        }
      });
    }

    function tlGoToVerify() {
      const issuer   = document.getElementById('tl-issuer').value.trim();
      const currency = (document.getElementById('tl-currency').value.trim() || 'USD').toUpperCase();

      // Show step 2 and populate display fields
      tlSetStep(2);
      document.getElementById('tl-verify-issuer-display').textContent   = issuer || 'r...';
      document.getElementById('tl-verify-currency-display').textContent = currency;
      document.getElementById('tl-verify-results').style.display  = 'none';
      document.getElementById('tl-verify-verdict').style.display  = 'none';
      document.getElementById('tl-verify-loading').style.display  = 'block';
      document.getElementById('tl-verify-badge').className = 'badge badge-pending';
      document.getElementById('tl-verify-badge').innerHTML = '<span class="badge-dot pulse"></span> Checking...';

      // ─────────────────────────────────────────────
      // BACKEND HOOK POINT
      // Replace setTimeout with:
      //   const res = await fetch('/api/check-issuer', {
      //     method: 'POST',
      //     headers: { 'Content-Type': 'application/json' },
      //     body: JSON.stringify({ issuer, currency })
      //   });
      //   const data = await res.json();
      //   // data: { valid, blacklisted, age_months, issues_currency, risk }
      //   showIssuerResults(data, currency);
      // ─────────────────────────────────────────────

      setTimeout(() => {
        const sim = {
          valid:           issuer.startsWith('r') && issuer.length >= 25,
          blacklisted:     Math.random() < 0.15,
          age_months:      Math.floor(Math.random() * 60 + 6),
          issues_currency: Math.random() > 0.2,
        };
        sim.risk = (!sim.valid || sim.blacklisted) ? 'high'
                 : !sim.issues_currency ? 'medium' : 'low';
        showIssuerResults(sim, currency);
      }, 1800);
    }

    function showIssuerResults(data, currency) {
      // ─────────────────────────────────────────────
      // BACKEND HOOK POINT
      // Called with API response. Shape: { valid, blacklisted, age_months, issues_currency, risk }
      // ─────────────────────────────────────────────
      document.getElementById('tl-verify-loading').style.display = 'none';
      document.getElementById('tl-verify-results').style.display = 'block';

      setTlVerifyCheck('validity', data.valid,
        data.valid ? 'This issuer account exists on the XRPL ledger.'
                   : 'This account does not exist on the XRPL ledger. Do not trust this issuer.');

      setTlVerifyCheck('blacklist', !data.blacklisted,
        !data.blacklisted ? 'Not found in any known scam or fraud database — low risk.'
                          : 'This issuer has been flagged as fraudulent. Do not set this trust line.');

      setTlVerifyCheck('age', data.age_months >= 6,
        data.age_months >= 6
          ? 'Issuer account is ' + data.age_months + ' months old — established presence.'
          : 'Account is only ' + data.age_months + ' month(s) old — very new issuers carry higher risk.');

      setTlVerifyCheck('currency', data.issues_currency,
        data.issues_currency
          ? 'This issuer does issue ' + currency + ' — trust line is relevant.'
          : 'No evidence this issuer issues ' + currency + '. Setting this trust line may do nothing.');

      // Verdict box
      const box   = document.getElementById('tl-verdict-box');
      const icon  = document.getElementById('tl-verdict-icon');
      const title = document.getElementById('tl-verdict-title');
      const desc  = document.getElementById('tl-verdict-desc');
      const warn  = document.getElementById('tl-confirm-warning');
      const btn   = document.getElementById('tl-confirm-btn');
      const badge = document.getElementById('tl-verify-badge');

      box.className = 'auth-overall';
      if (data.risk === 'low') {
        box.classList.add('safe');
        icon.textContent  = '✓';
        title.textContent = 'Issuer looks legitimate';
        desc.textContent  = 'All checks passed. Safe to proceed with this trust line.';
        badge.className   = 'badge badge-confirmed';
        badge.innerHTML   = '<span class="badge-dot"></span> Safe';
        warn.textContent  = '';
        btn.style.opacity = '1';
        btn.disabled      = false;
      } else if (data.risk === 'medium') {
        box.classList.add('warn');
        icon.textContent  = '⚠';
        title.textContent = 'Proceed with caution';
        desc.textContent  = 'Some checks raised concerns. You can still proceed, but verify this issuer through other channels first.';
        badge.className   = 'badge badge-pending';
        badge.innerHTML   = '<span class="badge-dot"></span> Caution';
        warn.textContent  = 'You can still confirm, but we recommend verifying this issuer independently first.';
        btn.style.opacity = '1';
        btn.disabled      = false;
      } else {
        box.classList.add('danger');
        icon.textContent  = '✕';
        title.textContent = 'High risk — we recommend backing out';
        desc.textContent  = 'This issuer failed multiple checks. Setting this trust line could expose you to fraud.';
        badge.className   = 'badge badge-expired';
        badge.innerHTML   = '<span class="badge-dot"></span> High risk';
        warn.textContent  = 'We strongly advise against this. If you still want to proceed, you can — but do so at your own risk.';
        btn.style.opacity = '0.5';
        btn.disabled      = false; // still let them if they want
      }

      document.getElementById('tl-verify-verdict').style.display = 'block';
    }

    function setTlVerifyCheck(id, passed, desc) {
      const icon   = document.getElementById('tl-v-' + id + '-icon');
      const descEl = document.getElementById('tl-v-' + id + '-desc');
      if (!icon || !descEl) return;
      icon.className   = 'auth-check-icon ' + (passed ? 'safe' : 'danger');
      icon.textContent = passed ? '✓' : '✕';
      descEl.textContent = desc;
    }

    function tlBackOut() {
      tlSetStep(1);
      // Reset verify state
      document.getElementById('tl-verify-results').style.display = 'none';
      document.getElementById('tl-verify-verdict').style.display = 'none';
      document.getElementById('tl-verify-loading').style.display = 'block';
    }

    function tlConfirm() {
      const issuer   = document.getElementById('tl-issuer').value.trim();
      const currency = (document.getElementById('tl-currency').value.trim() || 'USD').toUpperCase();

      // ─────────────────────────────────────────────
      // BACKEND HOOK POINT
      // Replace with real XRPL trust line submission:
      //   const res = await fetch('/api/set-trustline', {
      //     method: 'POST',
      //     headers: { 'Content-Type': 'application/json' },
      //     body: JSON.stringify({ issuer, currency, limit })
      //   });
      //   const data = await res.json();
      //   if (data.success) setTrustlineDone(currency, issuer);
      // ─────────────────────────────────────────────

      setTrustlineDone(currency, issuer || 'r...abc');
    }

    function submitTrustline() { tlGoToVerify(); }

    function setTrustlineDone(currency, issuer) {
      trustlineSet = true;

      // Update step 3 display
      const el_c = document.getElementById('tl-confirm-currency');
      const el_i = document.getElementById('tl-confirm-issuer');
      const el_d = document.getElementById('tl-dest-currency');
      if (el_c) el_c.textContent = currency || 'USD';
      if (el_i) el_i.textContent = issuer   || 'r...abc';
      if (el_d) el_d.textContent = currency || 'USD';

      tlSetStep(3);

      // Hide gates on gated pages
      ['trade-gate','send-gate'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
    }

        // ── Authenticator ──
    function runAuthCheck() {
      const input = document.getElementById('auth-input').value.trim();
      if (!input) return;

      document.getElementById('auth-loading').style.display = 'block';
      document.getElementById('auth-result').classList.remove('visible');

      setTimeout(() => {
        document.getElementById('auth-loading').style.display = 'none';
        showAuthResults(input);
      }, 1800);
    }

    function showAuthResults(address) {
      // ─────────────────────────────────────────────
      // BACKEND HOOK POINT
      // Expected shape: { valid, age_months, blacklisted, tx_count, has_trustline, currency, risk }
      //
      // Python example for trust line check:
      //   from xrpl.clients import JsonRpcClient
      //   from xrpl.models.requests import AccountLines
      //   client = JsonRpcClient("https://xrplcluster.com")
      //   resp = client.request(AccountLines(account=address))
      //   lines = resp.result.get("lines", [])
      //   has_trustline = any(l["currency"] == currency for l in lines)
      // ─────────────────────────────────────────────

      const isValid   = address.startsWith('r') && address.length >= 25;
      const isOld     = Math.random() > 0.3;
      const isClean   = Math.random() > 0.25;
      const isActive  = Math.random() > 0.2;
      const hasTl     = Math.random() > 0.35; // BACKEND: real trust line check

      // Detect what currency user is trying to send (from send page if active)
      const sendCurr  = document.getElementById('send-currency');
      const currency  = (sendCurr && sendCurr.value) ? sendCurr.value : 'XRP';

      setCheck('validity', isValid,
        isValid
          ? 'This address exists on the XRPL ledger, indicating positive safety levels.'
          : 'This address does not appear to exist on the XRPL ledger. Do not send funds to it.');

      const months = isOld ? Math.floor(Math.random()*36+6) : Math.floor(Math.random()*3+1);
      setCheck('age', isOld,
        isOld
          ? 'This account was created ' + months + ' months ago, classifying it as low risk.'
          : 'This account was created only ' + months + ' month(s) ago — new accounts can indicate scam activity.');

      setCheck('blacklist', isClean,
        isClean
          ? 'This account has not been flagged within blacklist databases — low risk.'
          : 'This account has been flagged in known scam/fraud databases — high risk. Do not send funds.');

      const txCount = isActive ? Math.floor(Math.random()*500+50) : Math.floor(Math.random()*5);
      setCheck('activity', isActive,
        isActive
          ? 'This account has ' + txCount + ' transactions on record, showing consistent usage.'
          : 'This account has very few transactions (' + txCount + '). Limited history increases risk.');

      // Trust line check
      const tlLabel = document.getElementById('chk-trustline-currency');
      if (tlLabel) tlLabel.textContent = currency !== 'XRP' ? '· ' + currency : '';

      if (currency === 'XRP') {
        setCheck('trustline', true,
          'XRP is native to the XRPL — no trust line required on either side.');
      } else {
        setCheck('trustline', hasTl,
          hasTl
            ? 'Recipient has an active ' + currency + ' trust line — they can receive this currency.'
            : 'Recipient does not have a ' + currency + ' trust line. They cannot receive this token — the transaction will fail.');
      }

      const tlOk = currency === 'XRP' || hasTl;
      const safeCount = [isValid, isOld, isClean, isActive, tlOk].filter(Boolean).length;

      const overall      = document.getElementById('auth-overall');
      const overallIcon  = document.getElementById('auth-overall-icon');
      const overallTitle = document.getElementById('auth-overall-title');
      const overallDesc  = document.getElementById('auth-overall-desc');

      overall.className = 'auth-overall';
      if (!tlOk) {
        overall.classList.add('warn');
        overallIcon.textContent  = '⚠';
        overallTitle.textContent = 'Cannot Receive ' + currency;
        overallDesc.textContent  = 'Recipient has no ' + currency + ' trust line. Ask them to set one up before you send.';
      } else if (safeCount >= 5) {
        overall.classList.add('safe');
        overallIcon.textContent  = '✓';
        overallTitle.textContent = 'Low Risk — Looks Safe';
        overallDesc.textContent  = 'All checks passed. This address appears safe to transact with.';
      } else if (safeCount >= 3) {
        overall.classList.add('warn');
        overallIcon.textContent  = '⚠';
        overallTitle.textContent = 'Medium Risk — Proceed with Caution';
        overallDesc.textContent  = 'Some checks raised concerns. Verify this address through another channel before sending large amounts.';
      } else {
        overall.classList.add('danger');
        overallIcon.textContent  = '✕';
        overallTitle.textContent = 'High Risk — Do Not Send';
        overallDesc.textContent  = 'Multiple checks failed. This address shows strong indicators of fraudulent activity.';
      }

      document.getElementById('auth-result').classList.add('visible');
    }

    function setCheck(id, passed, desc) {
      const icon = document.getElementById('chk-' + id + '-icon');
      const descEl = document.getElementById('chk-' + id + '-desc');
      icon.className = 'auth-check-icon ' + (passed ? 'safe' : 'danger');
      icon.textContent = passed ? '✓' : '✕';
      descEl.textContent = desc;
    }

    let tradeData = {};
    let trackInterval = null;
    let openOffers = [];

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById('page-' + id).classList.add('active');
      const navEl = document.getElementById('nav-' + id);
      if (navEl) navEl.classList.add('active');
    }

    function goTradeScreen(n) {
      document.querySelectorAll('.trade-screen').forEach(s => s.style.display = 'none');
      document.getElementById('trade-screen-' + n).style.display = 'block';
      window.scrollTo(0, 0);
      if (n === 2) startPending();
      if (n === 3) populateMatch();
      if (n === 4) populateConfirm();
    }

    function resetTrade() {
      if (trackInterval) clearInterval(trackInterval);
      goTradeScreen(1);
    }

    function captureForm() {
      tradeData.sellCurrency = document.getElementById('sell-currency').value;
      tradeData.sellAmount   = document.getElementById('sell-amount').value || '100';
      tradeData.buyCurrency  = document.getElementById('buy-currency').value;
      tradeData.buyAmount    = document.getElementById('buy-amount').value || '250';
      tradeData.offerId      = 'OFF-' + Math.random().toString(36).substr(2,8).toUpperCase();
      tradeData.txHash       = Array.from({length:64}, () => '0123456789ABCDEF'[Math.floor(Math.random()*16)]).join('');
      tradeData.ledgerIdx    = (87432100 + Math.floor(Math.random()*9999)).toLocaleString();
      tradeData.time         = new Date().toLocaleTimeString();
    }

    function startPending() {
      captureForm();
      document.getElementById('s2-offer-id').textContent = tradeData.offerId;
      document.getElementById('s2-sell').textContent     = tradeData.sellAmount + ' ' + tradeData.sellCurrency;
      document.getElementById('s2-buy').textContent      = tradeData.buyAmount  + ' ' + tradeData.buyCurrency;
      document.getElementById('s2-time').textContent     = tradeData.time;
      document.getElementById('s2-ledger').textContent   = 'Searching...';
      document.getElementById('track-fill').style.width  = '0%';
      document.getElementById('track-pct').textContent   = '0%';

      for (let i = 0; i < 4; i++) {
        const el = document.getElementById('stage-' + i);
        el.className = 'ledger-stage' + (i === 0 ? ' active-stage' : '');
        el.querySelector('.stage-icon').textContent = i === 0 ? '→' : i + 1;
      }

      if (trackInterval) clearInterval(trackInterval);
      const stages = [
        { pct: 25, ledger: 'Ledger #87432' + Math.floor(Math.random()*99) },
        { pct: 55, ledger: 'Scanning 2,400 offers...' },
        { pct: 80, ledger: 'Counterparty found' },
        { pct: 100, ledger: 'Match confirmed' },
      ];

      let step = 0;
      trackInterval = setInterval(() => {
        if (step >= stages.length) {
          clearInterval(trackInterval);
          setTimeout(() => goTradeScreen(3), 800);
          return;
        }
        const s = stages[step];
        document.getElementById('track-fill').style.width = s.pct + '%';
        document.getElementById('track-pct').textContent  = s.pct + '%';
        document.getElementById('s2-ledger').textContent  = s.ledger;
        for (let i = 0; i <= step; i++) {
          const el = document.getElementById('stage-' + i);
          el.className = 'ledger-stage ' + (i < step ? 'done-stage' : 'active-stage');
          el.querySelector('.stage-icon').textContent = i < step ? '✓' : '→';
        }
        step++;
      }, 1800);
    }

    function noMatchFound() {
      if (trackInterval) clearInterval(trackInterval);
      openOffers.push({
        id: tradeData.offerId,
        sell: tradeData.sellAmount + ' ' + tradeData.sellCurrency,
        buy:  tradeData.buyAmount  + ' ' + tradeData.buyCurrency,
        time: tradeData.time,
      });
      renderOpenOffers();
      showPage('dashboard');
    }

    function cancelOffer() {
      if (trackInterval) clearInterval(trackInterval);
      resetTrade();
      showPage('dashboard');
    }

    function renderOpenOffers() {
      const container = document.getElementById('open-offers-list');
      if (openOffers.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">⇄</div>No open offers yet.<br/>Create a trade to get started.</div>';
        return;
      }
      container.innerHTML = openOffers.map((o, i) => `
        <div class="offer-card">
          <div class="offer-info">
            <div class="offer-id">${o.id}</div>
            <div class="offer-pair">${o.sell} → ${o.buy}</div>
            <div class="offer-time">Submitted at ${o.time}</div>
          </div>
          <div class="offer-actions">
            <span class="badge badge-open"><span class="badge-dot"></span> Open</span>
            <button class="btn-sm" onclick="cancelOfferById(${i})">Cancel</button>
          </div>
        </div>
      `).join('');
    }

    function cancelOfferById(i) {
      openOffers.splice(i, 1);
      renderOpenOffers();
    }

    function populateMatch() {
      document.getElementById('match-id').textContent   = tradeData.offerId;
      document.getElementById('match-sell').textContent = tradeData.sellAmount + ' ' + tradeData.sellCurrency;
      document.getElementById('match-buy').textContent  = tradeData.buyAmount  + ' ' + tradeData.buyCurrency;
      const rate = (parseFloat(tradeData.buyAmount) / parseFloat(tradeData.sellAmount)).toFixed(4);
      document.getElementById('match-rate').textContent = rate + ' ' + tradeData.buyCurrency + ' per ' + tradeData.sellCurrency;
    }

    function populateConfirm() {
      document.getElementById('tx-hash').textContent       = tradeData.txHash;
      document.getElementById('confirm-sell').textContent  = tradeData.sellAmount + ' ' + tradeData.sellCurrency;
      document.getElementById('confirm-buy').textContent   = tradeData.buyAmount  + ' ' + tradeData.buyCurrency;
      document.getElementById('confirm-ledger').textContent = tradeData.ledgerIdx;
    }

    function copyHash() {
      navigator.clipboard.writeText(tradeData.txHash).then(() => {
        const el = document.getElementById('tx-hash');
        el.style.borderColor = '#22c55e';
        setTimeout(() => el.style.borderColor = '', 1500);
      });
    }

    function toggleEscrow(el) {
      el.classList.toggle('expanded');
    }

    function filterEscrows(status, btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.escrow-row').forEach(row => {
        if (status === 'all' || row.dataset.status === status) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }
  </script>

</body>
</html>
